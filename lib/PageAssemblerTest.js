"use strict";

const expect = require("chai").expect;
const PageAssembler = require("./PageAssembler");
const expectedPage = require("../resources/ExamplePageObject");

const dbResult = {"results":[{"columns":["page"],"data":[{"row":[{"type":"MyPageType","url":"http://myhost/myfolder/mypage","status":"Classified"}],"meta":[{"id":1244,"type":"node","deleted":false}]}]},{"columns":["page"],"data":[{"row":[{"references":[{"name":"my_reference_1","isCollection":false,"type":"MyReference1Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[1]/tr[1]/td[1]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[1]/tr[1]/td[11]","offset":120}},"destination":"http://myhost/myfolder/myotherpage1"},{"name":"my_reference_2","isCollection":false,"type":"MyReference2Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[2]/tr[2]/td[2]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[2]/tr[2]/td[22]","offset":120}},"destination":"http://myhost/myfolder/myotherpage2"},{"name":"my_reference_3","isCollection":false,"type":"MyReference3Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[3]/tr[3]/td[3]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[3]/tr[3]/td[33]","offset":120}},"destination":"http://myhost/myfolder/myotherpage3"},{"name":"my_reference_4","isCollection":true,"type":"MyReference4.1Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[41]/tr[41]/td[41]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[41]/tr[41]/td[411]","offset":120}},"destination":"http://myhost/myfolder/myotherpage4#1"},{"name":"my_reference_4","isCollection":true,"type":"MyReference4.2Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[42]/tr[42]/td[42]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[42]/tr[42]/td[422]","offset":120}},"destination":"http://myhost/myfolder/myotherpage4#2"}]}],"meta":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}]},{"columns":["result"],"data":[{"row":[{"parent":"176b48fad17a1c4d1c278a1c47940948","references":[{"name":"my_reference_3Item1","isCollection":true,"type":"MyReference3Item1.1Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[311]/tr[311]/td[311]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[311]/tr[311]/td[3111]","offset":120}},"destination":"http://myhost/myfolder/myotherpage3#1.1"},{"name":"my_reference_3Item1","isCollection":true,"type":"MyReference3Item1.2Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[312]/tr[312]/td[312]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[312]/tr[312]/td[3122]","offset":120}},"destination":"http://myhost/myfolder/myotherpage3#1.2"}]}],"meta":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]},{"row":[{"parent":"2ae9c40b28a208305b6aae864cd17341","references":[{"name":"my_reference_2.1","isCollection":false,"type":"MyReference2.1Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[21]/tr[21]/td[21]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[21]/tr[21]/td[211]","offset":120}},"destination":"http://myhost/myfolder/myotherpage2.1"},{"name":"my_reference_2.2","isCollection":false,"type":"MyReference2.2Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[22]/tr[22]/td[22]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[22]/tr[22]/td[222]","offset":120}},"destination":"http://myhost/myfolder/myotherpage2.2"}]}],"meta":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]},{"row":[{"parent":"99ee50ece1191c1bf875eded0866c54c","references":[{"name":"my_reference_2.1.1","isCollection":false,"type":"MyReference1.2Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[12]/tr[12]/td[12]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[12]/tr[12]/td[122]","offset":120}},"destination":"http://myhost/myfolder/myotherpage1.2"}]}],"meta":[null,null,null,null,null,null,null,null,null,null,null,null]},{"row":[{"parent":"c1b13f177c6446d1f0ecc37abbae005c","references":[{"name":"my_reference_1.1","isCollection":false,"type":"MyReference1.1Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[11]/tr[11]/td[11]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[11]/tr[11]/td[111]","offset":120}},"destination":"http://myhost/myfolder/myotherpage1.1"},{"name":"my_reference_1.2","isCollection":false,"type":"MyReference1.2Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//table[12]/tr[12]/td[12]","offset":0},"endSelector":{"type":"XPathSelector","value":"//table[12]/tr[12]/td[122]","offset":120}},"destination":"http://myhost/myfolder/myotherpage1.2"}]}],"meta":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}]},{"columns":["collect({type: property.type,checksum: property.checksum,name: relationship.name,content: propertyContent.value,isCollection: relationship.isCollection,selector: {type: relationship.selectorType,startSelector: {type: relationship.startSelectorType, value: relationship.startSelectorValue, offset: relationship.startSelectorOffset},endSelector: {type: relationship.endSelectorType, value: relationship.endSelectorValue, offset: relationship.endSelectorOffset}}})"],"data":[{"row":[[{"name":"my_property_1","checksum":"c1b13f177c6446d1f0ecc37abbae005c","content":"MyProperty1Content","isCollection":false,"type":"MyProperty1Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//p[1]/span[1]/span[1]","offset":0},"endSelector":{"type":"XPathSelector","value":"//p[1]/span[1]/span[11]","offset":120}}},{"name":"my_property_2","checksum":"2ae9c40b28a208305b6aae864cd17341","content":"MyProperty2Content","isCollection":false,"type":"MyProperty2Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//p[2]/span[2]/span[2]","offset":0},"endSelector":{"type":"XPathSelector","value":"//p[2]/span[2]/span[22]","offset":120}}},{"name":"my_property_3","checksum":"176b48fad17a1c4d1c278a1c47940948","content":"MyProperty3Item1Content","isCollection":true,"type":"MyProperty3Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//p[31]/span[31]/span[31]","offset":0},"endSelector":{"type":"XPathSelector","value":"//p[31]/span[31]/span[311]","offset":120}}},{"name":"my_property_3","checksum":"bac60ba1fcccf1636836b14be209e9ec","content":"MyProperty3Item2Content","isCollection":true,"type":"MyProperty3Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//p[32]/span[32]/span[32]","offset":0},"endSelector":{"type":"XPathSelector","value":"//p[32]/span[32]/span[322]","offset":120}}},{"name":"my_property_4","checksum":"4c820c612a246ceef61f26371795145e","content":"MyProperty4Content","isCollection":false,"type":"MyProperty4Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//p[4]/span[4]/span[4]","offset":0},"endSelector":{"type":"XPathSelector","value":"//p[4]/span[4]/span[44]","offset":120}}}]],"meta":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}]},{"columns":["collect({type: subProperty.type,checksum: subProperty.checksum,name: subPropertyRelationship.name,content: subPropertyContent.value,isCollection: subPropertyRelationship.isCollection,selector: {type: subPropertyRelationship.selectorType,startSelector: {type: subPropertyRelationship.startSelectorType, value: subPropertyRelationship.startSelectorValue, offset: subPropertyRelationship.startSelectorOffset},endSelector: {type: subPropertyRelationship.endSelectorType, value: subPropertyRelationship.endSelectorValue, offset: subPropertyRelationship.endSelectorOffset}}})"],"data":[{"row":[[{"name":"my_property_2.1","checksum":"99ee50ece1191c1bf875eded0866c54c","content":"MyProperty2.1Content","isCollection":false,"type":"MyProperty2.1Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//p[21]/span[2]/span[21]","offset":0},"endSelector":{"type":"XPathSelector","value":"//p[21]/span[2]/span[211]","offset":120}}},{"name":"my_property_2.2","checksum":"11fa789c32c7f7e77f0aefc96a281957","content":"MyProperty2.2Content","isCollection":false,"type":"MyProperty2.2Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//p[22]/span[2]/span[22]","offset":0},"endSelector":{"type":"XPathSelector","value":"//p[22]/span[22]/span[222]","offset":120}}},{"name":"my_property_2.3","checksum":"d5ede2981a48bf3f010f1159212ee85f","content":"MyProperty3Item1Content","isCollection":false,"type":"MyProperty3Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//p[31]/span[31]/span[31]","offset":0},"endSelector":{"type":"XPathSelector","value":"//p[31]/span[31]/span[311]","offset":120}}},{"name":"my_property_4.1","checksum":"125d7d11a0b5b87e5fd03b8ac3785e40","content":"MyProperty4.1Item1Content","isCollection":true,"type":"MyProperty4.1Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//p[411]/span[411]/span[411]","offset":0},"endSelector":{"type":"XPathSelector","value":"//p[411]/span[411]/span[4111]","offset":120}}},{"name":"my_property_4.1","checksum":"1234f373870b3b7bd921b49196a264ef","content":"MyProperty4.1Item2Content","isCollection":true,"type":"MyProperty4.1Type","selector":{"type":"RangeSelector","startSelector":{"type":"XPathSelector","value":"//p[412]/span[412]/span[412]","offset":0},"endSelector":{"type":"XPathSelector","value":"//p[412]/span[412]/span[4122]","offset":120}}}]],"meta":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}]},{"columns":["result"],"data":[{"row":[{"property":"2ae9c40b28a208305b6aae864cd17341","subProperties":[{"name":"my_property_2.1","checksum":"99ee50ece1191c1bf875eded0866c54c"},{"name":"my_property_2.2","checksum":"11fa789c32c7f7e77f0aefc96a281957"},{"name":"my_property_2.3","checksum":"d5ede2981a48bf3f010f1159212ee85f"}]}],"meta":[null,null,null,null,null,null,null]},{"row":[{"property":"4c820c612a246ceef61f26371795145e","subProperties":[{"name":"my_property_4.1","checksum":"125d7d11a0b5b87e5fd03b8ac3785e40"},{"name":"my_property_4.1","checksum":"1234f373870b3b7bd921b49196a264ef"}]}],"meta":[null,null,null,null,null]}]}],"errors":[]};

describe("#assembler", () => {
    it("should assemble correctly", () => {
        const pageAssembler = new PageAssembler();
        const page = pageAssembler.assemble(dbResult);
        expect(page).to.eql(expectedPage);
    });

    it("should assemble real pages correctly", () => {
        const pageAssembler = new PageAssembler();
        const page = pageAssembler.assemble(require("../resources/BaBwServiceDbResponse"));
        expect(page).to.eql(require("../resources/BaBwPageObject"));
    });
});